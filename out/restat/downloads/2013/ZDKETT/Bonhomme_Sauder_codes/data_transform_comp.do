*** Data transformationcapture log close* CHANGE THIS PATH VARIABLE TO YOUR PATH.cd \Users\uli\Desktop\Data_construction_comp\_submission_restatlog using transformcomp.smcl, replaceclearset mem 500muse compstep1out*drop first the regions to which the reform does not apply - Scotland*since the region information is a bit hidden, take info from all possible sources* Note that this region definition was changed and merged from earlier data.gen RE16=n3regionlab var RE16 "region at the age of sixteen (pooled sources)*here dropping Scotland and Warnock handicapped school leaversdrop if RE16==11drop if n15~=-1*generating dummies for latergen RE161=(RE16==1) if RE16~=-1gen RE162=(RE16==2) if RE16~=-1gen RE163=(RE16==3) if RE16~=-1gen RE164=(RE16==4) if RE16~=-1gen RE165=(RE16==5) if RE16~=-1gen RE166=(RE16==6) if RE16~=-1gen RE167=(RE16==7) if RE16~=-1gen RE168=(RE16==8) if RE16~=-1gen RE169=(RE16==9) if RE16~=-1/* RESTRICTED replace usick=. if usick >60replace mwork=. if mwork >80replace manage=. if manage>80replace skme=. if skme>80replace sskme=. if sskme>80replace immi=. if immi>60*//* Generating missing values for missing social class */replace n190=. if n190==-1generate sc65=n190-1replace sc65=. if sc65==0replace n1687=. if n1687==-1replace n1687=. if n1687>=7 & n1687<=10gen sc61=n1687gen sc58=n236-1replace sc58=. if n236<=0gen scgf=n526-1replace scgf=. if scgf<=0gen GRAMMAR=(n2102==2)lab var GRAMMAR "Attending Grammar school in 1974"  *generating fathers education**** consider taking extra-info from n195gen FEDUC=n2396 if n2396~=-1lab var FEDUC "Fathers completed education, years"gen MEDUC=n2397 if n2397~=-1lab var MEDUC "Mothers completed education, years"*/replacing -1 by missing values*Reproducing the summary stats from Vigneulles and Galindo Rueda...*generating an index for being in comprehensive schoolgen COMP74=(n2102==1) if n2102>=1 &n2102<=3lab var COMP74 " proportion enrolled in a comprehensive school compared to Sec. Mod. and Grammar 1974"gen SELEC=(n2102==2|n2102==3)lab var SELEC "enrolled in a selective school 1974"gen GRAM=(n2102==2)lab var GRAM "enrolled in a grammar school 1974"gen SECMOD=(n2102==3)lab var SECMOD "enrolled in a secondary modern school in 1974"gen COMP=(n14>=69 & n14<=74) if SELEC==0 lab var COMP "value 1 if comprehensiviation took place between 1969 and 1974"gen YCOMP=n14-68 if COMP==1 &n14~=-1lab var COMP "years spent in comprehensive between 1969 and 1974"*years of pre-comp selective schoolinggen yearsselec=5-(n14-69) if n14>=69 replace yearsselec=0 if n14<69 & n14>0replace yearsselec=5 if SELEC==1lab var yearsselec "Years spent in selective system"*proportion of LEA comprehensive in 1974gen propcom=n13/10 if n13~=-1 lab var propcom "Proportion of LEA comprehensive in 1974"*************                      NCDS family and household variables                   ************/* Sex indicator */gen cmsex=dmsex-1 if dmsex~=.lab var cmsex "Female dummy"/* Education in years after minimum school leaving age*/replace actagel2=lftmore2 if (lftmore2>actagel & lftmore2!=.z)replace actagel2=. if actagel2>30su actagel2, det/* natural mother and father at age 7 */gen natmoth7=(n103==3) if n103~=-1lab var natmoth7 "Natural mother in household, 1965"gen natfath7=(n104==3) if n104~=-1lab var natfath7 "Natural mother in household at age 7"/* father/mother employed */gen fathu16=(n2383==3) if n2383~=-1lab var fathu16 "Father unemployed (1974) "gen mothu11=(n1212==1) if n1212~=-1lab var mothu11 "Mother paid work at age 11"/*No mother/father figure */gen nomother=(n103==1) if n103~=-1lab var nomother "Child has no mother figure, 1965"gen nofather=(n104==9) if n104~=-1lab var nofather "Child has no father figure, 1965"/*Born in britisch iles (mum/dad) */gen mubornBI=(n1434==1) if n1434~=-1lab var mubornBI "Mother born in British Isles"gen mubornOS=(n1434>=4)  if n1434~=-1lab var mubornOS "Mother born overseas"gen fabornBI=(n1436==1) if n1434~=-1lab var fabornBI "Father born in British Isles"/*persons per room 74 */gen proom74=n1734 if n1734~=-1lab var proom74 "Persons per room in 1974"/*mother/father natural */gen mnatural=(n2371==1) if n2371~=-1lab var mnatural "Natural mother takes care of child in 1974"gen fnatural=(n2375==1) if n2375~=-1lab var fnatural "Natural father  takes care of child in 1974"/*accomodation type */gen acctype74=n2471 if n2471~=-1lab var acctype74 "Accomodation type in 1974"/*room for study */gen studyroom=(n2879==1) if n2879~=-1lab var studyroom "Child has a room to study/*older siblings */gen oldersib=n2363+n2365 if n2363~=-1 &n2365~=-1replace oldersib=n2363 if n2363~=-1 &n2365==-1replace oldersib=n2365 if n2365~=-1 &n2363==-1lab var oldersib "Total number of older siblings (girls/boys) of NCDS child"/*mother works */gen mwork65=(n197==2|n197==3) if n197~=-1lab var mwork65 "Mother works since child at school, 1965"/* Fathers banded income, weekly and monthly bands are equal */gen fbandinc=n2462 if n2462>=0 replace fbandinc=n2465 if n2465>=0lab var fbandinc "Fathers banded income, 1974"gen fbandincmiss=(n2462==-1)*(n2465==-1)gen FINC1=(fbandinc>=1)*(fbandinc<=5)gen FINC2=(fbandinc>=6)*(fbandinc<=7)gen FINC3=(fbandinc>=8)*(fbandinc<=9)gen FINC4=(fbandinc>=10)*(fbandinc<=12)/* Fathers banded income, weekly and monthly bands are equal */gen mbandinc=n2463 if n2463>=0replace mbandinc=n2466 if n2466>=0lab var mbandinc "Mothers banded income, 1974"gen MINC1=(mbandinc>=1)*(mbandinc<=5)gen MINC2=(mbandinc>=6)*(mbandinc<=12)/**** COHORT MEMBER characteristics *******//*TEST SCORES *//*BSAG score all syndroms n455*/gen bsag11=n1008 if n1008~=-1lab var bsag11 "Total score all syndroms BSAG"/* factors for the intelligence tests */gen math7=n90replace math7=. if n90==-1gen read7=n92replace read7=. if n92==-1gen draw=n1840replace draw=. if n1840==-1gen copy=n457replace copy=. if n457==-1gen verbal11=n914replace verbal11=. if verbal11==-1gen read11=n923replace read11=. if read11==-1gen math11=n926replace math11=. if n926==-1gen math16=n2930 if n2930~=-1gen read16=n2928 if n2928~=-1/*we will compute hourly and weekly, gross and net wages.All wages are calculated in 1981 prices. We calculated wages separately for the 2000 and 2004 surveyThese come in via the merge with ncdsadqual67.dta*//* Income first pay 1981, restrict to employees (see Costas Meghirs paper) *//****************************************** WAGES 1981 ****************************************/*variables*n4223 pay in first job*n4227 period of pay in first job*n4228 deductions first job pay 1=net, 2=gross, 3=no deducts, 8=.*n4229 accuracy first pay info*n4262 current job net pay*n4267 current job net pay period (1=day, 2=week, 3=forthnight,4=month, 5=3months, 6=sixmonths,7=year,9=other)*n4268 accuracy job net pay*n4269 current job gross pay*n4274 current job gross pay period*n4275 current job gross pay accuracy*n4213 employment status (1=employee, 2=agency temp,3=self-employed)*current job variables are clearly the only relevant*n4331 current job hours of work*n4421 last job hours of work*original pay variables (recoding if necessary)cap drop net_pay81gen net_pay81=n4262cap drop gro_pay81gen gro_pay81=n4269*selecting only workerscap drop worker81gen worker81=(n4213==1)* check for missing net and gross paycap drop znetpay81gen znetpay81=1 if net_pay81==.replace znetpay81=0 if net_pay81~=.cap drop zgropay81gen zgropay81=1 if gro_pay81==.replace zgropay81=0 if gro_pay81~=.*hourscap drop hours1gen hours1=n4331recode hours1 (97 99= .)cap drop hours2gen hours2=n4421recode hours2 (97=.)cap drop hoursg hours=hours1replace hours=hours2 if hours1==. & hours2~=. &worker81==1recode hours (0=.)tab hours/*pay period(1=day, 2=week, 3=forthnight,4=month, 5=3months, 6=sixmonths,7=year,9=other)*/cap drop net_prd81gen net_prd81=n4267cap drop gro_prd81gen gro_prd81=n4274*calculating weekly gross and net pay and hourly pay*weekly pay (net)cap drop wk_net81g wk_net81=net_pay81*7 if znetpay81==0 & net_prd81==1 &worker81==1replace wk_net81=(net_pay81) if znetpay81==0 & net_prd==2 &worker81==1replace wk_net81=(net_pay81/2) if znetpay81==0 & net_prd==3 &worker81==1replace wk_net81=(net_pay81*(12/52)) if znetpay81==0 & net_prd==4 &worker81==1replace wk_net81=(net_pay81*(4/52)) if znetpay81==0 & net_prd==5 &worker81==1replace wk_net81=(net_pay81*(2/52)) if znetpay81==0 & net_prd==6 &worker81==1replace wk_net81=(net_pay81*(1/52)) if znetpay81==0 & net_prd==7 &worker81==1replace wk_net81=. if znetpay81==0 & net_prd==8 &worker81==1*weekly pay (gross)cap drop wk_gro81g wk_gro81=gro_pay81*7 if zgropay81==0 & gro_prd81==1 &worker81==1replace wk_gro81=(gro_pay81) if zgropay81==0 & gro_prd81==2 &worker81==1replace wk_gro81=(gro_pay81/2) if zgropay81==0 & gro_prd81==3 &worker81==1replace wk_gro81=(gro_pay81*(12/52)) if zgropay81==0 & gro_prd81==4 &worker81==1replace wk_gro81=(gro_pay81*(4/52)) if zgropay81==0 & gro_prd81==5 &worker81==1replace wk_gro81=(gro_pay81*(2/52)) if zgropay81==0 & gro_prd81==6 &worker81==1replace wk_gro81=(gro_pay81*(1/52)) if zgropay81==0 & gro_prd81==7 &worker81==1replace wk_gro81=. if zgropay81==0 & gro_prd81==8 &worker81==1cap pr drop dohours81pr def dohours81*hourly net paycap drop hr_net81g hr_net81=wk_net81/hours if hours~=. & wk_net81~=. &worker81==1*hourly grosscap drop hr_gro81g hr_gro81=wk_gro81/hours if hours~=. & wk_gro81~=. &worker81==1enddohours81su hr_gro81 hr_net81 wk_gro81 wk_net81, det*FIX 1 *ratio check for hourly gross against hourly net paycap drop hr_prop81gen hr_prop81=wk_net81/wk_gro81 if wk_net81~=. & wk_gro81~=.cap drop odd_prop81g odd_prop81=(hr_prop81<0.4|hr_prop81>4)replace wk_gro81=. if odd_prop81==1replace wk_net81=. if odd_prop81==1dohours81su hr_gro81 hr_net81 wk_gro81 wk_net81, det*FIX 2*dropping some extreme values in the underlying wagesreplace wk_net81=. if wk_net81>165replace  wk_gro81=. if wk_gro81>300dohours81*FIX 3*dropping hourly wage above 10 since likely outliersreplace hr_net81=. if hr_net81>10replace hr_gro81=. if hr_gro81>10g Lwk_net81=log(wk_net81)g Lwk_gro81=log(wk_gro81)g Lhr_net81=log(hr_net81)g Lhr_gro81=log(hr_gro81)lab var Lwk_net81 "1981 log weekly net wage in 1981 prices"lab var Lwk_gro81 "1981 log weekly gross wage in 1981 prices"lab var Lhr_net81 "1981 log hourly net wage in 1981 prices"lab var Lhr_gro81 "1981 log hourly gross wage in 1981 prices"/********************************** WAGES 1991 *************************************/*original pay variables (recoding if necessary)cap drop net_pay91gen net_pay91=n500536recode net_pay91 (999996=.) (999999=.)cap drop gro_pay91gen gro_pay91=n500543recode gro_pay91 (999999=.)*selecting only workerscap drop workergen worker=(n500520<=4 & n500527==1)*missing net and gross paycap drop znetpay91gen znetpay91=1 if net_pay91==.replace znetpay91=0 if net_pay91~=.cap drop zgropaygen zgropay91=1 if gro_pay91==.replace zgropay91=0 if gro_pay91~=.*hourscap drop hours1gen hours1=n500550recode hours1 (98 99= .)cap drop hours2gen hours2=n500567cap drop zhours1g zhours1=n500550==.cap drop zhours2g zhours2=(n500567==.)cap drop hoursg hours=hours1replace hours=hours2 if zhours1==1 & zhours2==0 &worker==1recode hours (0=.)tab hours*pay period*1=1week*2=forthnight*3=four weeks*4=calendar month*5=year*6=other (set to missing)cap drop net_prd91gen net_prd91=n500542cap drop gro_prd91gen gro_prd91=n500549*calculating weekly gross and net pay and hourly pay*weekly pay (net)cap drop wk_net91g wk_net91=net_pay91 if znetpay91==0 & net_prd91==1 &worker==1replace wk_net91=(net_pay91/2) if znetpay91==0 & net_prd91==2 &worker==1replace wk_net91=(net_pay91/4) if znetpay91==0 & net_prd91==3 &worker==1replace wk_net91=(net_pay91*(12/52)) if znetpay91==0 & net_prd91==4 &worker==1replace wk_net91=(net_pay91/52) if znetpay91==0 & net_prd91==5 &worker==1replace wk_net91=. if znetpay91==0 & net_prd91==6 &worker==1*weekly pay (gross)cap drop wk_gro91g wk_gro91=gro_pay91 if zgropay91==0 & gro_prd91==1 &worker==1replace wk_gro91=(gro_pay91/2) if zgropay91==0 & gro_prd91==2 &worker==1replace wk_gro91=(gro_pay91/4) if zgropay91==0 & gro_prd91==3 &worker==1replace wk_gro91=(gro_pay91*(12/52)) if zgropay91==0 & gro_prd91==4 &worker==1replace wk_gro91=(gro_pay91/52) if zgropay91==0 & gro_prd91==5 &worker==1replace wk_gro91=. if zgropay91==0 & gro_prd91==6 &worker==1cap pr drop dohourspr def dohours*hourly net paycap drop hr_net91g hr_net91=wk_net91/hours if hours~=. & wk_net91~=. &worker==1*hourly grosscap drop hr_gro91g hr_gro91=wk_gro91/hours if hours~=. & wk_gro91~=. &worker==1enddohourstab wk_gro91*FIX 1 *ratio check for hourly gross against hourly net paycap drop hr_prop91gen hr_prop91=wk_net91/wk_gro91 if wk_net91~=.&wk_gro91~=.cap drop odd_prop91g odd_prop91=(hr_prop91<0.4|hr_prop91>4)replace wk_gro91=. if odd_prop91==1replace wk_net91=. if odd_prop91==1replace hr_gro91=. if odd_prop91==1replace hr_net91=. if odd_prop91==1*FIX 2*removing two extreme valuesreplace wk_gro91=. if wk_gro91>5000replace wk_net91=. if wk_net91>3000dohourstab hr_gro91tab hr_net91*FIX 3*removing some extreme values in hourly payreplace hr_gro91=. if hr_gro91>150|hr_gro91<1replace hr_net91=. if hr_net91>150 |hr_net91<1*Generating the log of these variables (coding scheme from before)*retail price index to adjust in 1981 pricesscalar rpi91=1.8523261g Lwk_net91=log(wk_net91/rpi91)g Lwk_gro91=log(wk_gro91/rpi91)g Lhr_net91=log(hr_net91/rpi91)g Lhr_gro91=log(hr_gro91/rpi91)lab var Lwk_net91 "1991 log weekly net wage in 1981 prices"lab var Lwk_gro91 "1991 log weekly gross wage in 1981 prices"lab var Lhr_net91 "1991 log hourly net wage in 1981 prices"lab var Lhr_gro91 "1991 log hourly gross wage in 1981 prices"***********************            school attendance                          *********************************gen schoolatt74=n1721 if n1721>0lab var schoolatt74 "Total school attendance"*how long has child been at this school (years)gen yearsschool74=n2284 if n2284~=-1lab var yearsschool74 "How long (in years) has child been at this school"*TEACHer: do you think child benefits staying on ?gen topinion74=1 if n2286==1replace topinion=0 if (n2286==2|n2286==3)lab var topinion "Will child benefit staying on ? Teacher answer"*age likely to leave (own opinion)gen likeleave74=n2729 if n2729~=-1 & n2729~=4lab var likeleave74 "Age you like to leave school, NCDS child answergen wishleft74=(n2741==1) if n2741~=-1 &n2741~=3lab var wishleft74 "Do you wish you had left school earlier, NCDS child answer"*************************                NCDS School variables                               *****************gen pupils74=n2104 if n2104~=-1lab var pupils74 "Number of pupils in school"gen boarders74=n2108 if n2108~=-1lab var boarders74 "Number of boarders of total pupils"gen singlesexgirls=(n2112==1) if n2112~=-1 & 2112~=.lab var singlesexgirls "School is a single sex school for girlsgen singlesexboys=(n2112==2) if n2112~=-1 & 2112~=.lab var singlesexboys "School is a single sex school for boys"gen singlesex=(n2112==1|n2112==2)lab var singlesex "School 69-74 is single-sex"*percentage of boys/girls staying on gen stayonboys=n2137 if n2137~=-1lab var stayonboys "% of boys staying on after min school leaving age"gen stayongirls=n2139 if n2139~=-1lab var stayongirls "% of girls staying on after min school leaving age"*part-time, full time teacher staff, pupil teacher ratiogen ftteach74=n2141 if n2141~=-1lab var ftteach74 "Number of full time teachers"gen pttequiv74=n2144 if n2144~=-1lab var pttequiv74 " Number of part-time teachers 1974"gen teachers74=ftteach74+pttequiv74 if ftteach74~=. & pttequiv74~=.lab var teachers74 "Total number of teachers 1974"gen ptr1=pupils74/ftteach74 if pupils74>1 &ftteach74>1lab var ptr1 "Pupil teacher ratio only full time teachers"gen ptr2=pupils74/teachers74 if pupils74>1 &teachers74>1lab var ptr2 "Pupil teacher ratio all teachers"replace ptr2=. if ptr2>30gen pupexp=n2170 if n2170~=-1lab var pupexp "Nb. pupils expelled last year" *ability streamingreplace n2157=-1 if n2157==5gen abstream74=(n2157==1) if n2157~=-1 lab var abstream74 "Class ability streamed, 1974"gen mixedab74=(n2157==2|n2157==3) if n2157~=-1 &n2157~=.lab var mixedab74 "Mixed ability class, 1974"*English/math class ability streamed in 1974 ?gen englstr74=(n2193==1) if n2193~=-1 & n2193~=.lab var englstr74 "English class streamed"gen mathstr74=(n2200==1) if n2200~=-1 & n2200~=.lab var mathstr74 "Maths class streamed"*class streamed in 1969 ?gen highab69=(n862==1) &n862~=-1lab var highab69 "Child is in high ability streamed class, 1969"gen avab69=(n862==2) & n862~=-1lab var avab69 "Child is in average ability streamed class, 1969"gen lowab69=(n862==3) & n862~=-1lab var lowab69 "Child is in low ability streamed class, 1969"gen nostream69=(n862==9) & n862~=-1lab var nostream69 "Child is not in an ability streamed class, 1969"*how comprehensive school formed gen CAMALG=(n2116==2) if n2116~=-1lab var CAMALG "Comprehensive school formed by amalgamtion"gen CPB=(n2116==1) if n2116~=-1lab var CPB "Comprehensive school purpose built"gen CSECM=(n2116==3) if n2116~=-1lab var CSECM "Comprehensive school formed out of secondary modern"gen CGRAM=(n2116==4) if n2116~=-1lab var CGRAM "Comprehensive school formed out of a Grammar school"gen gheadteach=(n812==2) if n812~=-1lab var gheadteach "Gender head-teacher ,1=female,1969"gen gmainteach=(n813==2) if n813~=-1lab var gmainteach "Gender main teacher,1=female,1969"gen sizeclass=n865 if n865~=-1lab var sizeclass "Number of pupils in childs class, 1969"/* School characteristics*/gen buildage69=n845 if n845~=-1lab var buildage69 "Age of the main school buildings, 1969"gen nleas65=(n20==1)lab var nleas65 "Not in LEA maintained school in 1965"gen infant65=(n20==2)lab var infant65 "In infant school in 1965"gen junior65=(n20==3)lab var junior65 "In junior and infant school in 1965"gen misc65=(n20>=4)lab var misc65 "In undefined school in 1965"gen miss65=(n20==-1)lab var miss65 "School type missing in 1965"/* some errors in pupil 65 */replace n24=-1 if n24==0gen pupil65=n24 if n24~=-1lab var pupil65 "Number of pupils on school roll, 1965"gen nchildc65=n46 if n46~=-1lab var nchildc65 "Number of children in child´s class, 1965"gen noschool=n112 if n112~=-1lab var noschool "Number of schools attended since age of 5, 1965"gen infant69=(n824==1)lab var infant69 "In infant school in 1965"gen junior69=(n824==2)lab var junior69 "In junior and infant school in 1965"gen misc69=(n825>=1)lab var misc69 "In other school, 1969"gen nchilds69=n829 if n829~=-1lab var nchilds69 "Number of children on school roll, 1969"gen teach69=n835+n836+n837+n838+n839+n840+n841 if n835~=-1 & n836~=-1 & n837~=-1 & n838~=-1 & n839~=-1 & n840~=-1 & n841~=-1lab var teach69 "Number of full time teachers in school, 1969"gen freemeal69=(n858==1) if n858~=-1lab var freemeal69 "Free school meals at school, 1969"gen noschool69=n1135 if n1135~=-1lab var noschool69 "Number of schools attended since age of 5, 1969"gen headtsex69=(n812==2) if n812~=-1lab var headtsex69 "Sex of headteacher, 1969"gen ptr69=nchilds69/teach69 lab var ptr69 "Pupil teacher ratio in 1969"replace ptr69=. if ptr69<=5 |ptr69>=50gen SCOMP69=(n875==1 & n2102==1)/*here data and a factor for parental preferences*/gen stay65=1 if n116==2replace stay65=0 if n116==3lab var stay65 "Parents want child to stay at school, 1965"gen left15=1 if n2403==1 replace left15=0 if n2403==2lab var left15 "Parents wish child left at 15"gen left15a=(n2407==1) if n2407~=-1 &n2407~=4lab var left15a "Parents wishes child leaves at 16"gen left18=(n2407==2) if n2407~=-1 &n2407~=4lab var left18 "Parents wishes child leaves at 18"gen leftlater=(n2407==3) if n2407~=-1 &n2407~=4lab var leftlater "Parents wishes child completes further educ."gen fathint74=n2324 if n2324~=-1 &n2324~=6lab var fathint74 "Fathers interest in child education"gen mothint74=n2325 if n2325~=-1 &n2325~=6lab var mothint74 "Mothers interest in child education"/* Here generating dummies and replacing all missing values by missing value indicators and zeros in the corresponding variables */*******************************  PARENTAL BACKGROUND and interest ****************generating fathers 1958 social class (default is manual)gen sc580=(n236==2) if n236~=-1gen sc581=(n236==3) if n236~=-1gen sc582=(n236==4) if n236~=-1gen sc583=(n236==5) if n236~=-1gen sc584=(n236==6) if n236~=-1*generating 1974 social class for father, default is unskilled manual(==7) (group 5 and 6 in ONE)/*gen sc19741=(n2384==1) if n2384~=-1gen sc19742=(n2384==2) if n2384~=-1gen sc19743=(n2384==3) if n2384~=-1gen sc19744=(n2384==4) if n2384~=-1gen sc19745=(n2384==5) if n2384~=-1gen sc19746=(n2384==6) if n2384~=-1*/*generating social class dummies for the NCDS 2 default is unskilled manualgen sc691=(n1175==1) if n1175~=-1gen sc692=(n1175==2) if n1175~=-1gen sc693=(n1175==3) if n1175~=-1gen sc694=(n1175==4) if n1175~=-1gen sc695=(n1175==5) if n1175~=-1gen sc696=(n1175==6) if n1175~=-1gen sc697=(n1175==7) if n1175~=-1gen sc698=(n1175==8) if n1175~=-1gen sc699=(n1175==9) if n1175~=-1gen sc6910=(n1175==10) if n1175~=-1gen sc6911=(n1175==12) if n1175~=-1gen sc6912=(n1175==13) if n1175~=-1gen sc6913=(n1175==14) if n1175~=-1gen sc6914=(n1175==15) if n1175~=-1gen sc6915=(n1175==16) if n1175~=-1*social class dummies for NCDS 1 1965 (default is manual)gen sc19651=1 if n190==2 replace sc19651=0 if sc19651==. &n190~=-1gen sc19652=1 if n190==3 replace sc19652=0 if sc19652==. & n190~=-1gen sc19653=1 if n190==4replace sc19653=0 if sc19653==. & n190~=-1gen sc19654=1 if n190==5replace sc19654=0 if sc19654==. & n190~=-1gen sc19655=1 if n190==6replace sc19655=0 if sc19655==. & n190~=-1gen sc19656=1 if n190==7replace sc19656=0 if sc19656==. & n190~=-1gen sc19741=(n2384==1) if n2384~=-1gen sc19742=(n2384==2) if n2384~=-1gen sc19743=(n2384==3) if n2384~=-1gen sc19744=(n2384==4) if n2384~=-1gen sc19745=(n2384==5) if n2384~=-1gen sc19746=(n2384==6) if n2384~=-1/* NEW: Social classes */gen scmiss=(n2384==-1)+(n2384==8)gen social1=(n2384==1)gen social2=(n2384==2)gen social3=(n2384==3|n2384==4)gen social4=(n2384==5|n2384==6)gen social5=(n2384==7)replace social1=social1+scmiss*(n1687==1)replace social2=social2+scmiss*(n1687==2)replace social3=social3+scmiss*(n1687==3|n1687==4)replace social4=social4+scmiss*(n1687==5)replace social5=social5+scmiss*(n1687==6)replace scmiss=1-social1-social2-social3-social4-social5replace social1=social1+scmiss*(n236==1)replace social2=social2+scmiss*(n236==2)replace social3=social3+scmiss*(n236==3|n236==4)replace social4=social4+scmiss*(n236==5)replace social5=social5+scmiss*(n236==6)replace scmiss=1-social1-social2-social3-social4-social5/* factor loadings (pca)redefine social classes and education and impute scores. Then extract a single factor... *//* Parback (revised) */gen FINC=FINC1+2*FINC2+3*FINC3+4*FINC4gen MINC=MINC1+2*MINC2gen social=social1+2*social2+3*social3+4*social4+5*social5pca FINC MINC social FEDUC MEDUC if scmiss==0, factor(1)predict parback if scmiss==0, scorepca math11 read11 verbal11 math7 read7, factor(1)predict abproxyall, scorepca verbal11 read11 math11, factor(1)predict absele, score/* REMOVE THIS BRACKET IF YOU WANT TO TREAT MISSING/* Here replacing all missing by dummies  ************MISSING ************************************************* */gen ptr69miss=(ptr69==.)replace ptr69=0 if ptr69==.lab var ptr69miss "Missing pupil teacher ratio 1969"gen natmoth7miss=(n103==-1)lab var natmoth7miss "Natural mother missing, 1965replace natmoth7=0 if natmoth7==.gen natfath7miss=(n103==-1)lab var natfath7miss "Natural father missing, 1965replace natfath7=0 if natfath7==.gen left15miss=(left15==.)lab var left15miss "Missing parents wished child left school at 15"replace left15=0 if left15==.replace stay65=0 if stay65==.gen stay65miss=(stay65==.)lab var stay65miss "Missing parents want child to stay on, 1965"gen leftlatermiss=(leftlater==.)replace leftlater=0 if leftlater==.lab var leftlatermiss "Missing: Parents wish child continues to further education"gen fathint74miss=(fathint74==.)replace fathint74=0 if fathint74==.lab var fathint74miss "Missing: fathers interest in child's education"gen mothint74miss=(mothint74==.)replace mothint74=0 if mothint74==.lab var mothint74miss "Missing: mothers interest in child's education"gen mbandincmiss=(mbandinc==.)replace mbandinc=0 if mbandinc==.lab var mbandincmiss "Mothers banded income measure missing"gen fbandincmiss=(fbandinc==.)replace fbandinc=0 if fbandinc==.lab var fbandincmiss "Mothers banded income measure missing"gen left18miss=(left18==.)replace left18=0 if left18==.lab var left18miss "Missing parents wish child left school at 18"gen left15miss=(left15==.)replace left15=0 if left15==.lab var left15miss "Missing parents wish child left school at 15"replace mwork65=0 if n197==-1|n197==1gen mwork65miss=(n197==-1|n197==1)lab var mwork65miss "Missing mother works since child at school, 1965"replace MEDUC=0 if MEDUC==.replace FEDUC=0 if FEDUC==.replace sc580=0 if sc581==.replace sc581=0 if sc581==.replace sc582=0 if sc582==.replace sc583=0 if sc583==.replace sc584=0 if sc584==.replace sc19651=0 if sc19651==.replace sc19652=0 if sc19652==.replace sc19653=0 if sc19653==.replace sc19654=0 if sc19654==.replace sc19655=0 if sc19655==.replace sc19656=0 if sc19656==.replace sc691=0 if sc691==.replace sc692=0 if sc692==.replace sc693=0 if sc693==.replace sc694=0 if sc694==.replace sc695=0 if sc695==.replace sc696=0 if sc696==.replace sc697=0 if sc697==.replace sc698=0 if sc698==.replace sc699=0 if sc699==.replace sc6910=0 if sc6910==.replace sc6911=0 if sc6911==.replace sc6912=0 if sc6912==.replace sc6913=0 if sc6913==.replace sc6914=0 if sc6914==.replace sc6915=0 if sc6915==.gen sc58miss=(n236==-1)gen sc65miss=(n190==1 |n190==.)gen sc69miss=(n1175==-1)gen sc74miss=(2384==-1)gen pupil65miss=(n24==-1)replace pupil65=0 if n24==-1lab var pupil65miss "Information on 1965 pupils missing"replace nchildc65=0 if n46==-1gen nchilc65miss=(n46==-1)lab var nchilc65miss "Missing number of children in child´s class, 1965"replace noschool=0 if n112==-1gen noschoolmiss=(n112==-1)lab var noschoolmiss "Missing number of schools attended, 1965"replace nchilds69=0 if n829==-1gen nchilds69miss=(n829==-1)lab var nchilds69miss "Missing number of children on school roll, 1969"replace teach69=0 if n836==-1gen teach69miss=(n836==-1)lab var teach69miss "Missing number of FT-teachers in 1969"replace freemeal69=0 if n858==-1gen freemeal69miss=(n858==-1)lab var freemeal69miss "Missing free school meals, 1969"replace noschool69=0 if n1135==-1gen noschool69miss=(n112==-1)lab var noschool69miss "Missing number of schools attended, 1969"replace headtsex69=0 if n812==-1gen headtsex69miss=(n812==-1)lab var headtsex69miss "Missing headteacher sex, 1969"replace buildage69=0 if n845==-1gen buildage69miss=(n845==-1)lab var buildage69miss "Missing age of school buildings, 1969"replace MEDUC=0 if MEDUC==.replace FEDUC=0 if FEDUC==.*fathers and mothers schooling missinggen fschoolmiss=(n2396==-1)lab var fschoolmiss "no schooling information on father"gen mschoolmiss=(n2397==-1)lab var mschoolmiss "no schooling information on mother"/* dummies for the missing 1974 variables */gen pupexpmiss=(pupexp==.)gen ptr1miss=(ptr1==.)gen stayongirlsmiss=(stayongirls==.)gen stayonboysmiss=(stayonboys==.)gen singlesexboysmiss=(singlesexboys==.)gen singlesexgirlsmiss=(singlesexgirls==.)gen pupils74miss=(pupils74==.)gen boarders74miss=(boarders74==.)replace pupexp=0 if pupexp==.  replace ptr1=0 if ptr1==.  replace stayongirls=0 if stayongirls==.replace stayonboys=0 if stayonboys==.replace singlesexboys=0 if singlesexboys==.replace singlesexgirls=0 if singlesexgirls==.replace pupils74=0 if pupils74==.replace boarders74=0 if boarders74==.lab var left15miss "Missing parents wish child left 15, 1974"lab var left18miss "Missing parents wish child left 18, 1974"lab var leftlatermiss "MissingParents wish child continues, 1974"lab var fathint74miss "Missing fathers interest , 1974"lab var mothint74miss "Missing: mothers interest , 1974"lab var mbandincmiss "Missing Mothers banded income, 1974"lab var fbandincmiss "Missing fathers banded income, 1974"*//*UNBRACKET IF YOU LIKE TO SEE SUMMARY statssutex HLcminc2000 HLcminc1991 Hlcminc1981 actagel2 math16 read16 math11 read11 verball bsag11 math7 read7 cmsex FEDUC MEDUC sc581-sc584 sc19651-sc19656 sc19691-sc196915, minmax labels file(\Users\uli\Desktop\comp\results\family.tex) replacesutex oldersib wishleft74 likeleave74 topinion74 yearsschool74 schoolatt74 studyroom FEDUC MEDUC fnatural mnatural  fabornBI mubornOS mubornBI nofather nomother mschoolmiss fschoolmiss natmoth7 natfath7 proom74 acctype74, minmax labels file(\Users\uli\Desktop\comp\results\family.tex) replacesutex GRAM SECMOD COMP propcom CGRAM CSECM CPB CAMALG nostream69 lowab69 avab69 highab69  pupil65 pupil65miss nchilc65miss nchildc65 noschool nchilds69 nchilds69miss  noschoolmiss infant69 junior69 misc69  freemeal69 freemeal69miss headtsex69 headtsex69miss buildage69 buildage69miss, minmax labels file(\Users\uli\Desktop\comp\results\school.tex) replacesutex left15 left15miss left18 left18miss leftlater leftlatermiss fathint74 fathint74miss mothint74 mothint74miss mbandinc mbandincmiss fbandinc fbandincmiss mwork65 mwork65miss, minmax labels file(\Users\uli\Desktop\comp\results\var74.tex) replace*//*A-Levels/O-levels and other quals...ADDING THIS QUALIFICATIONINFO*//*****Create a 6 category classification, inspired by the work of Samantha Parsons, Andrew Jenkins and Gerald Makepiece There are two sets of variables in the 1991 survey - one with qualifications obtained before 1981 and  another one with qualifications obtained afterwards. -> Condensing into one set of variables ****/local kk=41while `kk'<=69{local ll=`kk'-28replace n5014`kk'=n5015`ll' if n5015`ll'>0 &  n5015`ll'<=36 & (n5014`kk'==37| n5014`kk'==.)replace n5014`kk'=37 if (n5015`ll'==0| n5015`ll'==37) & n5014`kk'==.local kk=`kk'+2}/*This part is from the 1991 survey */*generating highest qualifaction obtained evergen hqual33=-1local kk=41while `kk'<=69{replace hqual33=0 if n5014`kk'==37replace hqual33=1 if n5014`kk'==10|n5014`kk'==25|n5014`kk'==1 & hqual33<1replace hqual33=2 if n5014`kk'==20|n5014`kk'==19|n5014`kk'==18|n5014`kk'==17|n5014`kk'==14 |n5014`kk'==13|n5014`kk'==12|n5014`kk'==11 |n5014`kk'==7|n5014`kk'==6|n5014`kk'==4 |n5014`kk'==3|n5014`kk'==3 & hqual33<2replace hqual33=3 if n5014`kk'==23|n5014`kk'==21 |n5014`kk'==15 |n5014`kk'==9  |n5014`kk'==8 |n5014`kk'==5  & hqual33<3replace hqual33=4 if n5014`kk'==30|n5014`kk'==29 |n5014`kk'==28 |n5014`kk'==27  |n5014`kk'==26 |n5014`kk'==24 |n5014`kk'==22 |n5014`kk'==16  & hqual33<4replace hqual33=5 if n5014`kk'==31|n5014`kk'==33 &hqual33<5local kk=`kk'+2}lab var hqual33 "Highest qualification gained at age 33 - based on age 33 (NCDS 5)"label define hqual33 0 "No qualification"label define hqual33 1 "CSE 2-5/equivalent NVQ1", addlabel define hqual33 2 "O-levels/equivalent NVQ2", addlabel define hqual33 3 "A-levels/equivalent NVQ3", addlabel define hqual33 4 "Higher quals/equivalent NVQ4", addlabel define hqual33 5 "Degree/equivalent NVQ5/6", addreplace hqual33=. if hqual33==-1*** Now creating the various vocational and academic rankings ****** We choose four measures for all 3 survey dates (1991,2000,2004) ****** where XX stands for the last two year digits, so XX=91,00,04 ****** REMARK: We only create here XX=91 ****** 1. hiacaXX Highest academic qual (8 level)*** 2. hianvqXX Highest academic qual in NVQ levels (6 level)*** 3. hivocXX Highest vocational qual (6 level)*** 4. hinvqXX Highest qual whereever NVQgen noquals=0 if n501441>=0gen cse2_5=0 if n501441>=0gen cse1=0 if n501441>=0gen oleva_c=0 if n501441>=0gen gcsea_c=0 if n501441>=0gen alev=0 if n501441>=0gen scotoa_c=0 if n501441>=0gen scots1_3=0 if n501441>=0gen scothg=0 if n501441>=0gen scot6th=0 if n501441>=0gen rsa1=0 if n501441>=0gen rsa2=0 if n501441>=0 gen rsa3=0 if n501441>=0gen cg_op=0 if n501441>=0gen cg_cio1=0 if n501441>=0gen cg_afp23=0 if n501441>=0gen cg_ft=0 if n501441>=0gen cg_oth=0 if n501441>=0gen cg_dk=0 if n501441>=0gen cg_ia=0 if n501441>=0gen jibnjcct=0 if n501441>0gen onchnd=0 if n501441>0gen hnchnd=0 if n501441>0gen bt_ngcd=0 if n501441>0gen bt_hhncd=0 if n501441>0gen othtbq=0 if n501441>0gen fprofq=0 if n501441>0gen pprofq=0 if n501441>0gen nurse=0 if n501441>0gen cert=0 if n501441>0gen hdippgce=0 if n501441>0gen degree=0 if n501441>0gen pgraddip=0 if n501441>0gen hdegree=0 if n501441>0local kk=41while `kk'<=69{replace noquals=1 if n5014`kk'==37replace cse2_5=1 if n5014`kk'==1replace cse1=1 if n5014`kk'==2replace oleva_c=1 if n5014`kk'==3replace gcsea_c=1 if n5014`kk'==4replace alev=1 if n5014`kk'==5replace scotoa_c=1 if n5014`kk'==6replace scots1_3=1 if n5014`kk'==7replace scothg=1 if n5014`kk'==8replace scot6th=1 if n5014`kk'==9replace rsa1=1 if n5014`kk'==10replace rsa2=1 if n5014`kk'==11replace rsa3=1 if n5014`kk'==12replace cg_op=1 if n5014`kk'==13replace cg_cio1=1 if n5014`kk'==14replace cg_afp23=1 if n5014`kk'==15replace cg_ft=1 if n5014`kk'==16replace cg_oth=1 if n5014`kk'==17replace cg_dk=1 if n5014`kk'==18replace cg_ia=1 if n5014`kk'==19replace jibnjcct=1 if n5014`kk'==20replace onchnd=1 if n5014`kk'==21replace hnchnd=1 if n5014`kk'==22replace bt_ngcd=1 if n5014`kk'==23replace bt_hhncd=1 if n5014`kk'==24replace othtbq=1 if n5014`kk'==25replace fprofq=1 if n5014`kk'==26replace pprofq=1 if n5014`kk'==27replace nurse=1 if n5014`kk'==28replace cert=1 if n5014`kk'==29replace hdippgce=1 if n5014`kk'==30replace degree=1 if n5014`kk'==31replace pgraddip=1 if n5014`kk'==32replace hdegree=1 if n5014`kk'==33local kk=`kk'+2}gen hiaca91=.replace hiaca91=0 if noquals==1replace hiaca91=2 if cse2_5==1replace hiaca91=3 if (cse1==1|oleva_c==1|gcsea_c==1|scotoa_c==1|scots1_3==1)replace hiaca91=5 if (alev==1|scothg==1|scot6th==1)replace hiaca91=6 if (cert==1|hdippgce==1)replace hiaca91=7 if (degree==1|pgraddip==1)replace hiaca91=8 if (hdegree==1)lab var hiaca91 "Highest academic qualification to match 2000 qualifications"label define hiaca91 0 "No qualifications"lab def hiaca91 2 "cse2_5", addlab def hiaca91 3 "good O-levels", addlab def hiaca91 5 "Alevels", addlab def hiaca91 6 "Diploma", addlab def hiaca91 7 "degree, PGCE", addlab def hiaca91 8 "higher degree", add* re-classify for NVQ levelsrecode hiaca91 (0=0) (2=1) (3=2) (5=3) (6=4) (7=4) (8=5), gen(hianvq91)*highest vocational qualgen hivoc91=.replace hivoc91=0 if noquals==1replace hivoc91=1 if (rsa1==1|othtbq==1|cg_oth==1|cg_dk==1)replace hivoc91=2 if (rsa2==1|cg_op==1|cg_cio1==1|cg_ia==1|jibnjcct==1)replace hivoc91=3 if (rsa3==1|cg_afp23==1|onchnd==1|bt_ngcd==1)replace hivoc91=4 if (cg_ft==1|hnchnd==1|bt_hhncd==1|fprofq==1|pprofq==1|nurse==1)lab var hivoc91 "Highest vocational qualification obtained"*Highest academic or vocational qualgen hinvq91=.replace hinvq91=0 if noquals==1replace hinvq91=1 if (rsa1==1|othtbq==1|cg_oth==1|cg_dk==1|cse2_5==1)replace hinvq91=2 if (rsa2==1|cg_op==1|cg_cio1==1|cg_ia==1|jibnjcct==1|cse1==1|oleva_c==1|scotoa_c==1|scots1_3==1)replace hinvq91=3 if (rsa3==1|cg_afp23==1|onchnd==1|bt_ngcd==1|alev==1|scothg==1|scot6th==1)replace hinvq91=4 if (cg_ft==1|hnchnd==1|bt_hhncd==1|fprofq==1|pprofq==1|nurse==1|cert==1|hdippgce==1|degree==1|pgraddip==1)     lab var hinvq91 "Highest academic or vocational qualification obtained in 1991"/************************************************************ JOINING EDUCATION QUALIFICATION VARIABLES  ***********************************************************/cap drop acaeight91cap drop aca_qual91cap drop voc_qual91g acaeight91=hiaca91g aca_qual91=hianvq91g voc_qual91=hivoc91***** CREATING THE FINAL SAMPLE *****local y2 "math11"local y1 "math7"local zlist "FEDUC MEDUC"  local option "two"qui{local ponelist "cmsex oldersib FEDUC MEDUC" local ptwolist "cmsex oldersib FEDUC MEDUC  ptr69 junior69  freemeal69 headtsex69 buildage69 stay65 nchildc65 noschool propcom nostream69 lowab69 avab69 highab69 "/* RESTRICTED */*local pthreelist "`ptwolist' usick mwork mininge manage skme sskme ppr iwc immi LA70"local pfourlist "`ptwolist' ptr2 wishleft74 likeleave74 topinion74 yearsschool74 schoolatt74 studyroom fnatural mnatural proom74 mothint74  fathint74  left15 leftlater left18 mwork65"** Create dummies D for missing covariates X** and create variables that are equal to the mean of X when D is one, zero otherwise foreach elem in `pfourlist'  {su `elem' if `elem'~=.gen `elem'miss=0 replace `elem'miss=r(mean) if `elem'==.replace `elem'=0 if `elem'==.} replace sc580=0 if sc581==.replace sc581=0 if sc581==.replace sc582=0 if sc582==.replace sc583=0 if sc583==.replace sc584=0 if sc584==.replace sc19651=0 if sc19651==.replace sc19652=0 if sc19652==.replace sc19653=0 if sc19653==.replace sc19654=0 if sc19654==.replace sc19655=0 if sc19655==.replace sc19656=0 if sc19656==.replace sc691=0 if sc691==.replace sc692=0 if sc692==.replace sc693=0 if sc693==.replace sc694=0 if sc694==.replace sc695=0 if sc695==.replace sc696=0 if sc696==.replace sc697=0 if sc697==.replace sc698=0 if sc698==.replace sc699=0 if sc699==.replace sc6910=0 if sc6910==.replace sc6911=0 if sc6911==.replace sc6912=0 if sc6912==.replace sc6913=0 if sc6913==.replace sc6914=0 if sc6914==.replace sc6915=0 if sc6915==.replace sc19741=0 if sc19741==.replace sc19742=0 if sc19742==.replace sc19743=0 if sc19743==.replace sc19744=0 if sc19744==.replace sc19745=0 if sc19745==.replace sc19746=0 if sc19746==.gen sc58miss=(n236==-1)gen sc65miss=(n190==1 |n190==.)gen sc69miss=(n1175==-1)gen sc74miss=(2384==-1) /* RESTRICTED - APPLY FOR LOCAL LICENSE TO USE ** Regroup "hertfordshore" and "formely middx" *replace n4=431 if n4==542replace n801=431 if n801==542replace n2092=431 if n2092==542 */** Date at which the school became comprehensiverename n14 Datecomp** Other outcomerename actagel2 yearsedurename aca_qual91 academicrename voc_qual91 vocationalrename Lwk_net91 logwage/* RESTRICTED - APPLY FOR LOCAL LICENSE TO USE** Merge with data on percentages of comprehensive schools in the LEArename comp70 comp72gen comp67a=.gen comp67b=.gen comp67c=.gen comp72a=.gen comp72b=.gen comp72c=.gen dcompa=.gen dcompb=.gen dcompc=.** The ado file fillmobi creates the percentage variabesqui bys la: fillmobi*/** Lists of variableslocal onelist "cmsex sc580-sc584 sc58miss sc69* sc1965* sc65miss oldersib oldersibmiss mwork65 mwork65miss MINC1-MINC2 FINC1-FINC4" local twolist "`onelist' stay65 stay65miss nchildc65 nchildc65miss noschool noschoolmiss ptr69 ptr69miss junior69 buildage69 buildage69miss nostream69"local threelist "`twolist' RE161-RE169"** Keep children who stayed five years at the same school** and keep only comprehensive, grammar and secondary modern schoolskeep if (n2284==5&(n2102==2|n2102==3))|(n2284==5&n2102==1)gen C=(n2102==1)}** Selection of variables keep `threelist' `fourlist' math16 math11 read16 read11 math7 read7 verbal11 draw copy C FEDUC MEDUC FEDUCmiss MEDUCmiss /**/	GRAM SECMOD Datecomp yearsedu academic vocational logwage** Creating the datasetsave samplefinal, replace